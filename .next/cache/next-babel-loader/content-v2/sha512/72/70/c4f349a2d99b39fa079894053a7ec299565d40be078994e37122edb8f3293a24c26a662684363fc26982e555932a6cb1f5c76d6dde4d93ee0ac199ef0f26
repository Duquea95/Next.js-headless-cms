{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/anthony/Documents/storefront-api-examples/react-hooks-apollo/components/Layout.js\";\nimport React, { useState, useEffect } from 'react';\nimport { useQuery, useMutation } from '@apollo/react-hooks';\nimport Product from '../components/Product';\nimport Cart from '../components/Cart';\nimport CustomerAuthWithMutation from '../components/CustomerAuth';\nimport gql from 'graphql-tag';\nimport { useCheckoutEffect, createCheckout, checkoutLineItemsAdd, checkoutLineItemsUpdate, checkoutLineItemsRemove, checkoutCustomerAssociate } from '../pages/checkout';\nconst query = gql`\n  query query {\n    shop {\n      name\n      description\n      products(first:20) {\n        pageInfo {\n          hasNextPage\n          hasPreviousPage\n        }\n        edges {\n          node {\n            id\n            title\n            options {\n              id\n              name\n              values\n            }\n            variants(first: 250) {\n              pageInfo {\n                hasNextPage\n                hasPreviousPage\n              }\n              edges {\n                node {\n                  id\n                  title\n                  selectedOptions {\n                    name\n                    value\n                  }\n                  image {\n                    src\n                  }\n                  price\n                }\n              }\n            }\n            images(first: 250) {\n              pageInfo {\n                hasNextPage\n                hasPreviousPage\n              }\n              edges {\n                node {\n                  src\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n`;\n\nfunction Layout(props) {\n  const {\n    0: isCartOpen,\n    1: setCartOpen\n  } = useState(false);\n  const {\n    0: isNewCustomer,\n    1: setNewCustomer\n  } = useState(false);\n  const {\n    0: isCustomerAuthOpen,\n    1: setCustomerAuthOpen\n  } = useState(false);\n  const {\n    0: showAccountVerificationMessage,\n    1: setAccountVerificationMessage\n  } = useState(false);\n  const {\n    0: checkout,\n    1: setCheckout\n  } = useState({\n    lineItems: {\n      edges: []\n    }\n  });\n  const {\n    0: customerAccessToken,\n    1: setCustomerAccessToken\n  } = useState(null);\n  const [createCheckoutMutation, {\n    data: createCheckoutData,\n    loading: createCheckoutLoading,\n    error: createCheckoutError\n  }] = useMutation(createCheckout);\n  const [lineItemAddMutation, {\n    data: lineItemAddData,\n    loading: lineItemAddLoading,\n    error: lineItemAddError\n  }] = useMutation(checkoutLineItemsAdd);\n  const [lineItemUpdateMutation, {\n    data: lineItemUpdateData,\n    loading: lineItemUpdateLoading,\n    error: lineItemUpdateError\n  }] = useMutation(checkoutLineItemsUpdate);\n  const [lineItemRemoveMutation, {\n    data: lineItemRemoveData,\n    loading: lineItemRemoveLoading,\n    error: lineItemRemoveError\n  }] = useMutation(checkoutLineItemsRemove);\n  const [customerAssociateMutation, {\n    data: customerAssociateData,\n    loading: customerAssociateLoading,\n    error: customerAssociateError\n  }] = useMutation(checkoutCustomerAssociate);\n  const {\n    loading: shopLoading,\n    error: shopError,\n    data: shopData\n  } = useQuery(query);\n  useEffect(() => {\n    const variables = {\n      input: {}\n    };\n    createCheckoutMutation({\n      variables\n    }).then(res => {\n      console.log(res);\n    }, err => {\n      console.log('create checkout error', err);\n    });\n  }, []);\n  useCheckoutEffect(createCheckoutData, 'checkoutCreate', setCheckout);\n  useCheckoutEffect(lineItemAddData, 'checkoutLineItemsAdd', setCheckout);\n  useCheckoutEffect(lineItemUpdateData, 'checkoutLineItemsUpdate', setCheckout);\n  useCheckoutEffect(lineItemRemoveData, 'checkoutLineItemsRemove', setCheckout);\n  useCheckoutEffect(customerAssociateData, 'checkoutCustomerAssociate', setCheckout);\n\n  const handleCartClose = () => {\n    setCartOpen(false);\n  };\n\n  const openCustomerAuth = event => {\n    if (event.target.getAttribute('data-customer-type') === \"new-customer\") {\n      setNewCustomer(true);\n      setCustomerAuthOpen(true);\n    } else {\n      setNewCustomer(false);\n      setCustomerAuthOpen(true);\n    }\n  };\n\n  const accountVerificationMessage = () => {\n    setAccountVerificationMessage(true);\n    setTimeout(() => {\n      setAccountVerificationMessage(false);\n    }, 5000);\n  };\n\n  const closeCustomerAuth = () => {\n    setCustomerAuthOpen(false);\n  };\n\n  const addVariantToCart = (variantId, quantity) => {\n    const variables = {\n      checkoutId: checkout.id,\n      lineItems: [{\n        variantId,\n        quantity: parseInt(quantity, 10)\n      }]\n    }; // TODO replace for each mutation in the checkout thingy. can we export them from there???\n    // create your own custom hook???\n\n    lineItemAddMutation({\n      variables\n    }).then(res => {\n      setCartOpen(true);\n    });\n  };\n\n  const updateLineItemInCart = (lineItemId, quantity) => {\n    const variables = {\n      checkoutId: checkout.id,\n      lineItems: [{\n        id: lineItemId,\n        quantity: parseInt(quantity, 10)\n      }]\n    };\n    lineItemUpdateMutation({\n      variables\n    });\n  };\n\n  const removeLineItemInCart = lineItemId => {\n    const variables = {\n      checkoutId: checkout.id,\n      lineItemIds: [lineItemId]\n    };\n    lineItemRemoveMutation({\n      variables\n    });\n  };\n\n  const associateCustomerCheckout = customerAccessToken => {\n    const variables = {\n      checkoutId: checkout.id,\n      customerAccessToken: customerAccessToken\n    };\n    customerAssociateMutation({\n      variables\n    }).then(res => {\n      setCustomerAuthOpen(false);\n    });\n  };\n\n  if (shopLoading) {\n    return /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"Loading ...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 12\n    }, this);\n  }\n\n  if (shopError) {\n    return /*#__PURE__*/_jsxDEV(\"p\", {\n      children: shopError.message\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 12\n    }, this);\n  }\n\n  console.log(shopData.shop.products);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"App\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"Flash__message-wrapper\",\n      children: /*#__PURE__*/_jsxDEV(\"p\", {\n        className: `Flash__message ${showAccountVerificationMessage ? 'Flash__message--open' : ''}`,\n        children: \"We have sent you an email, please click the link included to verify your email address\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(CustomerAuthWithMutation, {\n      closeCustomerAuth: closeCustomerAuth,\n      isCustomerAuthOpen: isCustomerAuthOpen,\n      newCustomer: isNewCustomer,\n      associateCustomerCheckout: associateCustomerCheckout,\n      showAccountVerificationMessage: accountVerificationMessage\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"header\", {\n      className: \"App__header\",\n      children: [/*#__PURE__*/_jsxDEV(\"ul\", {\n        className: \"App__nav\",\n        children: [/*#__PURE__*/_jsxDEV(\"li\", {\n          className: \"button App__customer-actions\",\n          onClick: openCustomerAuth,\n          \"data-customer-type\": \"new-customer\",\n          children: \"Create an Account\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 216,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          className: \"login App__customer-actions\",\n          onClick: openCustomerAuth,\n          children: \"Log in\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 217,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 9\n      }, this), !isCartOpen && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"App__view-cart-wrapper\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"App__view-cart\",\n          onClick: () => setCartOpen(true),\n          children: \"Cart\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 221,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 220,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"App__title\",\n        children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n          children: [shopData.shop.name, \": React Example\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 225,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n          children: shopData.shop.description\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 224,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"Product-wrapper\",\n      children: shopData.shop.products.edges.map(product => /*#__PURE__*/_jsxDEV(Product, {\n        addVariantToCart: addVariantToCart,\n        checkout: checkout,\n        product: product.node\n      }, product.node.id.toString(), false, {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 11\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Cart, {\n      removeLineItemInCart: removeLineItemInCart,\n      updateLineItemInCart: updateLineItemInCart,\n      checkout: checkout,\n      isCartOpen: isCartOpen,\n      handleCartClose: handleCartClose,\n      customerAccessToken: customerAccessToken\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 203,\n    columnNumber: 5\n  }, this);\n}\n\nexport default Layout;","map":{"version":3,"sources":["/Users/anthony/Documents/storefront-api-examples/react-hooks-apollo/components/Layout.js"],"names":["React","useState","useEffect","useQuery","useMutation","Product","Cart","CustomerAuthWithMutation","gql","useCheckoutEffect","createCheckout","checkoutLineItemsAdd","checkoutLineItemsUpdate","checkoutLineItemsRemove","checkoutCustomerAssociate","query","Layout","props","isCartOpen","setCartOpen","isNewCustomer","setNewCustomer","isCustomerAuthOpen","setCustomerAuthOpen","showAccountVerificationMessage","setAccountVerificationMessage","checkout","setCheckout","lineItems","edges","customerAccessToken","setCustomerAccessToken","createCheckoutMutation","data","createCheckoutData","loading","createCheckoutLoading","error","createCheckoutError","lineItemAddMutation","lineItemAddData","lineItemAddLoading","lineItemAddError","lineItemUpdateMutation","lineItemUpdateData","lineItemUpdateLoading","lineItemUpdateError","lineItemRemoveMutation","lineItemRemoveData","lineItemRemoveLoading","lineItemRemoveError","customerAssociateMutation","customerAssociateData","customerAssociateLoading","customerAssociateError","shopLoading","shopError","shopData","variables","input","then","res","console","log","err","handleCartClose","openCustomerAuth","event","target","getAttribute","accountVerificationMessage","setTimeout","closeCustomerAuth","addVariantToCart","variantId","quantity","checkoutId","id","parseInt","updateLineItemInCart","lineItemId","removeLineItemInCart","lineItemIds","associateCustomerCheckout","message","shop","products","name","description","map","product","node","toString"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useQuery, useMutation } from '@apollo/react-hooks';\nimport Product from '../components/Product';\nimport Cart from '../components/Cart';\nimport CustomerAuthWithMutation from '../components/CustomerAuth';\nimport gql from 'graphql-tag';\nimport {\n  useCheckoutEffect,\n  createCheckout,\n  checkoutLineItemsAdd,\n  checkoutLineItemsUpdate,\n  checkoutLineItemsRemove,\n  checkoutCustomerAssociate,\n} from '../pages/checkout';\n\nconst query = gql`\n  query query {\n    shop {\n      name\n      description\n      products(first:20) {\n        pageInfo {\n          hasNextPage\n          hasPreviousPage\n        }\n        edges {\n          node {\n            id\n            title\n            options {\n              id\n              name\n              values\n            }\n            variants(first: 250) {\n              pageInfo {\n                hasNextPage\n                hasPreviousPage\n              }\n              edges {\n                node {\n                  id\n                  title\n                  selectedOptions {\n                    name\n                    value\n                  }\n                  image {\n                    src\n                  }\n                  price\n                }\n              }\n            }\n            images(first: 250) {\n              pageInfo {\n                hasNextPage\n                hasPreviousPage\n              }\n              edges {\n                node {\n                  src\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n`;\n\nfunction Layout(props){\n\n  const [isCartOpen,setCartOpen] = useState(false);\n  const [isNewCustomer,setNewCustomer] = useState(false);\n  const [isCustomerAuthOpen,setCustomerAuthOpen] = useState(false);\n  const [showAccountVerificationMessage,setAccountVerificationMessage] = useState(false);\n  const [checkout,setCheckout] = useState({ lineItems: { edges: [] }});\n\n  const [customerAccessToken, setCustomerAccessToken] = useState(null);\n\n  const [createCheckoutMutation,\n  {\n    data: createCheckoutData,\n    loading: createCheckoutLoading,\n    error: createCheckoutError\n  }] = useMutation(createCheckout);\n\n  const [lineItemAddMutation,\n  {\n    data: lineItemAddData,\n    loading: lineItemAddLoading,\n    error: lineItemAddError\n  }] = useMutation(checkoutLineItemsAdd);\n\n  const [lineItemUpdateMutation,\n  {\n    data: lineItemUpdateData,\n    loading: lineItemUpdateLoading,\n    error: lineItemUpdateError\n  }] = useMutation(checkoutLineItemsUpdate);\n\n  const [lineItemRemoveMutation,\n  {\n    data: lineItemRemoveData,\n    loading: lineItemRemoveLoading,\n    error: lineItemRemoveError\n  }] = useMutation(checkoutLineItemsRemove);\n\n  const [customerAssociateMutation,\n  {\n    data: customerAssociateData,\n    loading: customerAssociateLoading,\n    error: customerAssociateError\n  }] = useMutation(checkoutCustomerAssociate);\n\n  const { loading:shopLoading, error:shopError, data:shopData } = useQuery(query);\n\n  useEffect(() => {\n    const variables = { input: {} };\n    createCheckoutMutation({ variables }).then(\n      res => {\n        console.log( res );\n      },\n      err => {\n        console.log('create checkout error', err );\n      }\n    );\n\n  }, []);\n\n  useCheckoutEffect(createCheckoutData, 'checkoutCreate', setCheckout);\n  useCheckoutEffect(lineItemAddData, 'checkoutLineItemsAdd', setCheckout);\n  useCheckoutEffect(lineItemUpdateData, 'checkoutLineItemsUpdate', setCheckout);\n  useCheckoutEffect(lineItemRemoveData, 'checkoutLineItemsRemove', setCheckout);\n  useCheckoutEffect(customerAssociateData, 'checkoutCustomerAssociate', setCheckout);\n\n  const handleCartClose = () => {\n    setCartOpen( false );\n  };\n\n  const openCustomerAuth = (event) => {\n    if (event.target.getAttribute('data-customer-type') === \"new-customer\") {\n      setNewCustomer( true );\n      setCustomerAuthOpen( true );\n    } else {\n      setNewCustomer( false );\n      setCustomerAuthOpen( true );\n    }\n  };\n\n  const accountVerificationMessage = () => {\n    setAccountVerificationMessage(true)\n    setTimeout(() => {\n      setAccountVerificationMessage(false)\n   }, 5000);\n  };\n\n  const closeCustomerAuth = () => {\n    setCustomerAuthOpen(false);\n  };\n\n  const addVariantToCart = (variantId, quantity) =>{\n    const variables = { checkoutId:checkout.id, lineItems:  [{variantId, quantity: parseInt(quantity, 10)}] };\n    // TODO replace for each mutation in the checkout thingy. can we export them from there???\n    // create your own custom hook???\n\n    lineItemAddMutation({ variables }).then(res => {\n        setCartOpen(true);\n    });\n  };\n\n  const updateLineItemInCart = (lineItemId, quantity) => {\n    const variables = { checkoutId:checkout.id, lineItems: [{id: lineItemId, quantity: parseInt(quantity, 10)}] };\n    lineItemUpdateMutation({ variables });\n  };\n\n  const removeLineItemInCart = (lineItemId) => {\n    const variables = { checkoutId:checkout.id, lineItemIds: [lineItemId] };\n    lineItemRemoveMutation({ variables });\n  };\n\n  const associateCustomerCheckout = (customerAccessToken) => {\n\n    const variables = { checkoutId:checkout.id, customerAccessToken: customerAccessToken };\n    customerAssociateMutation({ variables }).then((res) => {\n      setCustomerAuthOpen(false);\n    });\n  };\n\n  if (shopLoading) {\n    return <p>Loading ...</p>;\n  }\n\n  if (shopError) {\n    return <p>{shopError.message}</p>;\n  }\n\n  console.log(shopData.shop.products)\n\n  return (\n    <div className=\"App\">\n      <div className=\"Flash__message-wrapper\">\n        <p className={`Flash__message ${showAccountVerificationMessage ? 'Flash__message--open' : ''}`}>We have sent you an email, please click the link included to verify your email address</p>\n      </div>\n      <CustomerAuthWithMutation\n        closeCustomerAuth={closeCustomerAuth}\n        isCustomerAuthOpen={isCustomerAuthOpen}\n        newCustomer={isNewCustomer}\n        associateCustomerCheckout={associateCustomerCheckout}\n        showAccountVerificationMessage={accountVerificationMessage}\n      />\n      <header className=\"App__header\">\n        <ul className=\"App__nav\">\n          <li className=\"button App__customer-actions\" onClick={openCustomerAuth} data-customer-type=\"new-customer\">Create an Account</li>\n          <li className=\"login App__customer-actions\" onClick={openCustomerAuth}>Log in</li>\n        </ul>\n        {!isCartOpen &&\n          <div className=\"App__view-cart-wrapper\">\n            <button className=\"App__view-cart\" onClick={()=> setCartOpen( true )}>Cart</button>\n          </div>\n        }\n        <div className=\"App__title\">\n          <h1>{shopData.shop.name}: React Example</h1>\n          <h2>{shopData.shop.description}</h2>\n        </div>\n      </header>\n      <div className=\"Product-wrapper\">\n        { shopData.shop.products.edges.map(product =>\n          <Product addVariantToCart={addVariantToCart} checkout={checkout} key={product.node.id.toString()} product={product.node} />\n        )}\n      </div>\n      <Cart\n        removeLineItemInCart={removeLineItemInCart}\n        updateLineItemInCart={updateLineItemInCart}\n        checkout={checkout}\n        isCartOpen={isCartOpen}\n        handleCartClose={handleCartClose}\n        customerAccessToken={customerAccessToken}\n      />\n    </div>\n  );\n}\n\nexport default Layout"]},"metadata":{},"sourceType":"module"}